{% extends 'AlbatrossUserBundle:Default:layout_v2.html.twig' %}
{% block title %}Operation Table{% endblock %}

{% block body %}

<style>
    html, *{outline:none;}
    .wave-content-list{margin:5px 0px 5px 0px;}
    .wave-content-list label.pull-left{width:150px;}
    .submit-dropdown i{color:#fff;padding:3px 2px 3px 1px;display:inline-block;margin-right:10px;}
    .copyright-box{background:#e1e1e1;padding-top:15px;padding-bottom:15px;}
    .noborder{border:none;padding:5px 10px;color:#fff;}
    .progress{background:#e1e1e1;height:5px;margin-bottom:5px;}
    .color-red{color:red;}
    .icon-exclamation-sign{font-size:14px;}
    .search-holder{position:absolute;padding:0px;}
    .left-search-cont{width:88%;padding-left:15px;}
    .right-search-cont{padding-right:15px;}
    .iBlock{display:inline-block;}
    .nBorder{border:1px solid #aaa;}
    .row-fluid .span1{width:200px;}
    .chzn-container{margin-top:3px;}
    .ctrl{margin-left:5px;margin-right:5px;}
    .fleft{float:left;}
    .fright{float:right;}
    .sub1{display:none;}
    .sub2{display:none;}
    
    #advSearch{display:none;padding-left:15px;padding-right:15px;}
    #advSearch .elWidth{width:166px;}
    #advSearch .elWidth2{width:95px;}
    #advSearch .elWidthDate{width:120px;}
    #data-table_length{float:left;margin-top:19px;margin-right:15px;}
    #data-table_info{float: left;font-weight:bold;}
    #data-table{transition:margin-top .3s ease-in-out;-webkit-transition:margin-top .3s ease-in-out;-moz-transition:margin-top .3s ease-in-out;}
    #datetimepicker1 input[type=text]{border:1px solid #aaa;padding:4px;}
    #datetimepicker1 span{padding:4px;}
    #datetimepicker2 input[type=text]{border:1px solid #aaa;padding:4px;}
    #datetimepicker2 span{padding:4px;}
    #datetimepicker3 input[type=text]{border:1px solid #aaa;padding:4px;}
    #datetimepicker3 span{padding:4px;}
    
    #advSearch2{display:none;padding-left:15px;padding-right:15px;}
    #advSearch2 .elWidth{width:166px;}
    #advSearch2 .elWidth2{width:60px;}
    #advSearch2 .elWidthDate{width:120px;}
</style>

<div class="row-fluid">
    <div class="span-12">
        <div class="tab-widget">
            <ul class="nav nav-tabs" id="myTab1">
                <li class="active"><a href="#questionnaire">QUESTIONNAIRE SEARCH</a></li>
                <li><a href="#ace">ACE PROJECT SEARCH</a></li>
            </ul>
            <div class="tab-content">
                
                <div class="tab-pane active" id="ace">
                    <div class="navbar-inner gray controls search-holder">
                        <form action="#" method="get" class="navbar-search" style="padding:15px 0px 10px 0px;width:100%;">
                            <div class="pull-left left-search-cont">
                                <i class="icon-filter pull-left" style="font-size:30px;margin-right:10px;"></i>
                                <select data-placeholder="Ace Name" multiple class="chzn-select span1 iBlock nBorder" name="">
                                    <option value=""></option>
                                    <option>AN1</option>
                                    <option>AN2</option>
                                    <option>AN3</option>
                                    <option>AN4</option>
                                    <option>AN5</option>
                                </select>
                                &nbsp;&nbsp;
                                <select data-placeholder="Ace Number" multiple class="chzn-select span1 iBlock nBorder">
                                    <option value=""></option>
                                    <option>AN1</option>
                                    <option>AN2</option>
                                    <option>AN3</option>
                                    <option>AN4</option>
                                    <option>AN5</option>
                                </select>
                                &nbsp;&nbsp;
                                <select data-placeholder="Brand" multiple class="chzn-select span1 iBlock nBorder">
                                    <option value=""></option>
                                    <option>B1</option>
                                    <option>B2</option>
                                    <option>B3</option>
                                    <option>B4</option>
                                    <option>B5</option>
                                </select>
                                &nbsp;&nbsp;
                                <select data-placeholder="Project Manager" multiple class="chzn-select span1 iBlock nBorder">
                                    <option value=""></option>
                                    <option>PM1</option>
                                    <option>PM2</option>
                                    <option>PM3</option>
                                    <option>PM4</option>
                                    <option>PM5</option>
                                </select>
                                &nbsp;&nbsp;
                                <select class="span1 iBlock nBorder" style="margin-top:-12px;">
                                    <option>Show Projects</option>
                                    <option>My Projects</option>
                                    <option>Late Projects</option>
                                    <option>All Projects</option>
                                </select>
                                &nbsp;&nbsp;
                                <div class="iBlock">
                                    <a href="#" id="advLink2"><i class="icon-plus"></i> Advance Options</a>
                                </div>
                                <div class="clearfix"></div>
                            </div>
                            <div class="pull-right right-search-cont">
                                <button class="btn btn-success" type="submit">Search</button>
                                <button class="btn" type="reset">Clear</button>
                            </div>
                            <div class="clearfix"></div>
                            <div id="advSearch2">
                                <div class="ctrl fleft">
                                    <select data-placeholder="Business Unit" multiple class="chzn-select iBlock nBorder" style="width:200px;">
                                        <option value=""></option>
                                        <option>BU1</option>
                                        <option>BU2</option>
                                        <option>BU3</option>
                                        <option>BU4</option>
                                        <option>BU5</option>
                                    </select>
                                </div>
                                <div class="ctrl fleft">
                                    <select data-placeholder="Country" multiple class="chzn-select iBlock nBorder" style="width:200px;">
                                        <option value=""></option>
                                        <option>C1</option>
                                        <option>C2</option>
                                        <option>C3</option>
                                        <option>C4</option>
                                        <option>C5</option>
                                    </select>
                                </div>
                                <div class="ctrl fleft" style="margin-top:3px;">
                                    <div id="datetimepicker1" class="input-append">
                                        <input data-format="yyyy-MM-dd" type="text" placeholder="FW Start Date" class="elWidthDate"><span class="add-on"><i data-time-icon="icon-time" data-date-icon="icon-calendar"></i></span>
                                    </div>
                                </div>
                                <div class="ctrl fleft" style="margin-top:3px;">
                                    <div id="datetimepicker2" class="input-append">
                                        <input data-format="yyyy-MM-dd" type="text" placeholder="FW End Date" class="elWidthDate"><span class="add-on"><i data-time-icon="icon-time" data-date-icon="icon-calendar"></i></span>
                                    </div>
                                </div>
                                <div class="ctrl fleft" style="margin-top:3px;">
                                    <div id="datetimepicker3" class="input-append">
                                        <input data-format="yyyy-MM-dd" type="text" placeholder="Report Delivery Datee" class="elWidthDate"><span class="add-on"><i data-time-icon="icon-time" data-date-icon="icon-calendar"></i></span>
                                    </div>
                                </div>
                                <div class="ctrl fleft">
                                    <div>
                                        <input type="number" placeholder="% Assigned" class="elWidth2" style="border:1px solid #aaa;padding:4px;" /> to <input type="number" placeholder="% Assigned" class="elWidth2" style="border:1px solid #aaa;padding:4px;" />
                                    </div>
                                </div>
                                <div class="ctrl fleft">
                                    <div>
                                        <input type="number" placeholder="% Done" class="elWidth2" style="border:1px solid #aaa;padding:4px;" /> to <input type="number" placeholder="% Done" class="elWidth2" style="border:1px solid #aaa;padding:4px;" />
                                    </div>
                                </div>
                                <div class="ctrl fleft">
                                    <div>
                                        <input type="number" placeholder="% Editing Done" class="elWidth2" style="border:1px solid #aaa;padding:4px;" /> to <input type="number" placeholder="% Editing Done" class="elWidth2" style="border:1px solid #aaa;padding:4px;" />
                                    </div>
                                </div>
                                <div class="clearfix"></div>
                            </div>
                        </form>
                    </div>
                </div>
                
                <div class="tab-pane active" id="questionnaire">
                    <div class="navbar-inner gray controls search-holder">
                        <form action="{{ path('projectStatus') }}/questionnaire" method="get" class="navbar-search" style="padding:15px 0px 10px 0px;width:100%;">
                            <div class="pull-left left-search-cont">
                                <i class="icon-filter pull-left" style="font-size:30px;margin-right:10px;"></i>
                                <select data-placeholder="Questionnaire/Campaign" class="chzn-select span1 iBlock nBorder" name="surveySelection[]">
                                    <option value=""></option>
                                    <option>Q1</option>
                                    <option>Q2</option>
                                    <option>Q3</option>
                                    <option>Q4</option>
                                    <option>Q5</option>
                                </select>
                                &nbsp;&nbsp;
                                <select data-placeholder="Brand" multiple class="chzn-select span1 iBlock nBorder" name="albatross_operationbundle_projectstatusaoltype[brand][]">
                                    <option value=""></option>
                                    <option>B1</option>
                                    <option>B2</option>
                                    <option>B3</option>
                                    <option>B4</option>
                                    <option>B5</option>
                                </select>
                                &nbsp;&nbsp;
                                <select data-placeholder="Business Unit" multiple class="chzn-select span1 iBlock nBorder" name="albatross_operationbundle_projectstatusaoltype[bu][]">
                                    <option value=""></option>
                                    <option>BU1</option>
                                    <option>BU2</option>
                                    <option>BU3</option>
                                    <option>BU4</option>
                                    <option>BU5</option>
                                </select>
                                &nbsp;&nbsp;
                                <select data-placeholder="Country" multiple class="chzn-select span1 iBlock nBorder" name="albatross_operationbundle_projectstatusaoltype[country][]">
                                    <option value=""></option>
                                    <option>C1</option>
                                    <option>C2</option>
                                    <option>C3</option>
                                    <option>C4</option>
                                    <option>C5</option>
                                </select>
                                &nbsp;&nbsp;
                                <select class="span1 iBlock nBorder" style="margin-top:-12px;">
                                    <option>Show Projects</option>
                                    <option>My Projects</option>
                                    <option>Late Projects</option>
                                    <option>All Projects</option>
                                </select>
                                &nbsp;&nbsp;
                                <div class="iBlock">
                                    <a href="#" id="advLink"><i class="icon-plus"></i> Advance Options</a>
                                </div>
                                <div class="clearfix"></div>
                            </div>
                            <div class="pull-right right-search-cont">
                                <button class="btn btn-success" type="submit">Search</button>
                                <button class="btn" type="reset">Clear</button>
                            </div>
                            <div class="clearfix"></div>
                            <div id="advSearch">
                                <div class="ctrl fleft">
                                    <input type="text" placeholder="Keyword" class="span1" style="border:1px solid #aaa;padding:4px;" name="albatross_operationbundle_projectstatusaoltype[questionnairename]" />
                                </div>
                                <div class="ctrl fleft">
                                    <div id="datetimepicker1" class="input-append">
                                        <input data-format="yyyy-MM-dd" type="text" placeholder="FW Start Date" class="elWidthDate span1" name="albatross_operationbundle_projectstatusaoltype[fw_s_f]"><span class="add-on"><i data-time-icon="icon-time" data-date-icon="icon-calendar"></i></span>
                                    </div>
                                </div>
                                <div class="ctrl fleft">
                                    <div id="datetimepicker2" class="input-append">
                                        <input data-format="yyyy-MM-dd" type="text" placeholder="FW End Date" class="elWidthDate span1" name="albatross_operationbundle_projectstatusaoltype[fw_e_f]"><span class="add-on"><i data-time-icon="icon-time" data-date-icon="icon-calendar"></i></span>
                                    </div>
                                </div>
                                <div class="ctrl fleft">
                                    <div>
                                        <input type="number" placeholder="% Assigned" class="elWidth2 span1" style="border:1px solid #aaa;padding:4px;" name="albatross_operationbundle_projectstatusaoltype[assign_f]" /> to <input type="number" placeholder="% Assigned" class="elWidth2" style="border:1px solid #aaa;padding:4px;" name="albatross_operationbundle_projectstatusaoltype[assign_t]" />
                                    </div>
                                </div>
                                <div class="ctrl fleft">
                                    <div>
                                        <input type="number" placeholder="% Done" class="elWidth2 span1" style="border:1px solid #aaa;padding:4px;" name="albatross_operationbundle_projectstatusaoltype[fw_done_f]" /> to <input type="number" placeholder="% Done" class="elWidth2" style="border:1px solid #aaa;padding:4px;" name="albatross_operationbundle_projectstatusaoltype[fw_done_t]" />
                                    </div>
                                </div>
                                <div class="ctrl fleft">
                                    <div>
                                        <input type="number" placeholder="% Editing Done" class="elWidth2 span1" style="border:1px solid #aaa;padding:4px;" name="albatross_operationbundle_projectstatusaoltype[editing_done_f]" /> to <input type="number" placeholder="% Editing Done" class="elWidth2" style="border:1px solid #aaa;padding:4px;" name="albatross_operationbundle_projectstatusaoltype[editing_done_t]" />
                                    </div>
                                </div>
                                <div class="clearfix"></div>
                            </div>
                        </form>
                    </div>
                </div>
                
            </div>
        </div>
    </div>
</div>

<div style="margin-top: 60px;"></div>

{% if result != null %}
<div id="result-box" class="row-fluid">
    <div class="span12">
        <table class="table table-striped table-bordered" id="data-table">
        <thead>
            {% if type != 'questionnaire' %}
            <tr id="status-ace-title">
            {% else %}
            <tr id="status-q-title">
            {% endif %}
                <th id="title-name">
                    <span id="questionnairename" onclick="sortBy(this);">{% if type == 'questionnaire' %}By Questionnaire{% else %}By Project{% endif %}</span>
                </th>
                <th class="result-date">
                    <span id="fwsdate" onclick="sortBy(this);">FW Start</span>
                </th>
                <th class="result-date">
                    <span id="fwedate" onclick="sortBy(this);">FW End</span>
                </th>
                <th class="result-num">
                    <span id="num" onclick="sortBy(this);">No Surveys<br/>AOL</span>
                </th>
                <th class="result-num">
                    <span id="assigned" onclick="sortBy(this);">% Assigned</span>
                </th>
                <th class="result-num">
                    <span id="done" onclick="sortBy(this);">% FW Done</span>
                </th>
                <th class="result-num">
                    <span id="validationPercent" onclick="sortBy(this);">% Editing Done</span>
                </th>
                <th class="result-date">
                    <span id="firstDate" onclick="sortBy(this);">First Visit<br/>Actual Date</span>
                </th>
                <th class="result-date">
                    <span id="scope" onclick="sortBy(this);">Last Visit<br/>Actual Date</span>
                </th>
                <th class="result-date">
                    <span id="reportdate" onclick="sortBy(this);">Report<br/>Delivery</span>
                </th>
            </tr>
        </thead>
        <tbody>
            {% for id,r in result %}
                <tr class="questionnaire-result">
                    {% if type == 'questionnaire' %}
                    <td class="result-name" onclick="getBuResult('{{id}}', this);">
                            {{r['questionnairename']}}<br/>
                            <font class="italic-style">{{ r['campaignname'] }}</font>
                    </td>
                    {% else %}
                    <td class="result-name" onclick="getAceBuResult('{{id}}', this);">
                        {{r['aceprojectname']}}
                    </td>
                    {% endif %}
                {% if type == 'questionnaire' %}
                    <td class="result-date result-name" onclick="getBuResult('{{id}}', this);">{{ r['fwsdate'] }}</td>
                    <td class="result-date result-name" onclick="getBuResult('{{id}}', this);">{{ r['fwedate'] }}</td>
                    <td class="result-num">{{ r['num'] }}</td>
                    <td class="result-num">{{ r['assigned'] }}% ({{ r['assignnum'] }})</td>
                    <td class="result-num">{{ r['done'] }}% ({{ r['fwdonenum'] }})</td>
                    <td class="result-num">{{ r['validationPercent'] }}% ({{ r['edit'] }})</td>
                    <td class="result-date">{{ r['firstDate'] }}</td>
                    <td class="result-date">{{ r['lastDate'] }}</td>
                    <td class="result-date result-name" onclick="getBuResult('{{id}}', this);">{{ r['reportdate'] }}</td>
                {% else %}
                    <td class="result-date result-name" onclick="getAceBuResult('{{id}}', this);">{{ r['fwsdate'] }}</td>
                    <td class="result-date result-name" onclick="getAceBuResult('{{id}}', this);">{{ r['fwedate'] }}</td>
                    <td class="result-num">{{ r['num'] }}</td>
                    <td class="result-num">{{ r['assigned'] }}% ({{ r['assignnum'] }})</td>
                    <td class="result-num">{{ r['done'] }}% ({{ r['fwdonenum'] }})</td>
                    <td class="result-num">{{ r['validationPercent'] }}% ({{ r['edit'] }})</td>
                    <td class="result-date">{{ r['firstDate'] }}</td>
                    <td class="result-date">{{ r['lastDate'] }}</td>
                    <td class="result-date result-name" onclick="getAceBuResult('{{id}}', this);">{{ r['reportdate'] }}</td>
                {% endif %}
                </tr>
            {% endfor %}
        </tbody>
        </table>
    </div>
</div>
<div id="count-box">
    <table id="count-table">
        <tr>
            <th id="total-title"></th>
            <td id="total"></td>
        </tr>
        <tr>
            <th id="aol-title"></th>
            <td id="aol"></td>
        </tr>
    </table>
</div>
{% endif %}

<br>

<script src="{{ asset('bundles/falgun/') }}js/jquery.tablesorter.min.js"></script>
<script>
    $(function() {
        $(".paper-table").tablecloth({
            theme: "paper",
            striped: true,
            sortable: true,
            condensed: false
        });
    });
    
    $(function () {
        $('#data-table').dataTable({
            "sDom": "<'row-fluid'<'span12'>r>t<'row-fluid'<'span6'li><'span6'p>>"
        });

    });
    
    $(function () {
        $(".chzn-select").chosen();
        $(".chzn-select-deselect").chosen({
            allow_single_deselect: true
        });
    });
    
    $(function () {
        $('#datetimepicker1, #datetimepicker2, #datetimepicker3').datetimepicker({
            pickTime: false
        });
    });
    
    function getBuResult(id, e){
        var data = '{"id":"'+id+'"';
        {% if buArr != '' %}
            {% for k,bu in buArr %}
                data = data + ',"{{k}}":"{{bu}}"';
            {% endfor %}
        {% else %}
            data = data + ',"bu":"empty"';
        {% endif %}
            data = data + '}';
        if($(e).parent().next().attr('class') === 'bu-result-tr'){
            $(e).parent().nextAll().each(function(){
                if($(this).attr('class') === 'bu-result-tr' || $(this).attr('class') === 'c-result-tr'){
                    $(this).remove();
                }else{
                    return false;
                }
            });
        }else{
            $.ajax({
                data: data,
                type: "POST",
                url: "{{ path('getBuResult') }}",
                success: function(result) {
                    $(e).parent().after(result);
                }
            });
        }
    }
    
    function getAceBuResult(id, e){
        var data = '{"id":"'+id+'"';
        {% if buArr != '' %}
            {% for k,bu in buArr %}
                data = data + ',"{{k}}":"{{bu}}"';
            {% endfor %}
        {% else %}
            data = data + ',"bu":"empty"';
        {% endif %}
            data = data + '}';
        if($(e).parent().next().attr('class') === 'bu-result-tr'){
            $(e).parent().nextAll().each(function(){
                if($(this).attr('class') === 'bu-result-tr'){
                    $(this).remove();
                }else{
                    return false;
                }
            });
        }else{
            $.ajax({
                data: data,
                type: "POST",
                url: "{{ path('getAceBuResult') }}",
                success: function(result) {
                    $(e).parent().after(result);
                }
            });
        }
    }
    
    function getCountryResult(id, e, buid){
        var data = '{"cid":"'+ id + '", "bid":"' + buid + '"}';
        if($(e).parent().parent().parent().parent().parent().next().attr('class') === 'c-result-tr'){
            $(e).parent().parent().parent().parent().parent().nextAll().each(function(){
                if($(this).attr('class') === 'c-result-tr'){
                    $(this).remove();
                }else{
                    return false;
                }
            });
        }else{
            $.ajax({
                data: data,
                type: "POST",
                url: "{{ path('getCountryResult') }}",
                success: function(result) {
                    $(e).parent().parent().parent().parent().parent().after(result);
                }
            });
        }
    }
    
    function getAceCountryResult(id, e, buid){
        var data = '{"pid":"'+ id + '", "bid":"' + buid + '"}';
        if($(e).parent().parent().parent().parent().parent().next().attr('class') === 'c-result-tr'){
            $(e).parent().parent().parent().parent().parent().nextAll().each(function(){
                if($(this).attr('class') === 'c-result-tr'){
                    $(this).remove();
                }else{
                    return false;
                }
            });
        }else{
            $.ajax({
                data: data,
                type: "POST",
                url: "{{ path('getAceCountryResult') }}",
                success: function(result) {
                    $(e).parent().parent().parent().parent().parent().after(result);
                }
            });
        }
    }
    
    $(document).ready(function(){
        $(".search-holder").width($(".tab-content").width() + 1);
        
        $(window).resize(function(){
            $(".search-holder").width($(".tab-content").width() + 1);
        });
        
        $("#advLink2").click(function(){
            $("#advSearch2").slideToggle(function(){
                if (!$("#advSearch2").is(":visible")) {
                    $("#advLink2 i").removeClass("icon-minus").addClass("icon-plus");
                    $("#data-table").css("margin-top","0");
                } else {
                    $("#advLink2 i").removeClass("icon-plus").addClass("icon-minus");
                    $("#data-table").css("margin-top",$("#advSearch2").height());
                }
            });
            return false;
        });

    });
</script>
{% endblock %}